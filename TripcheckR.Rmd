---
title: "TripCheckR"
author: "Winston Saunders"
date: "October 26, 2014"
output: html_document
---

```{r "get_tweets"}

##This program assumes you have already run the TwitterReader.R to download a feed timeline. 
##It reads the data in teh form of a .csv 

## Get the relevnat tweet data

        file_name <- "TripCheckUS20B"

        hwy20Bfull<-read.csv(paste0(file_name, ".csv"))

        ##make the date column a date
        hwy20Bfull$created<-as.Date(hwy20Bfull$created)

        ##convert data to dataframe
        hwy_df<-hwy20Bfull

```

The data pulled is from `r hwy_df$created[1]` to `r hwy_df$created[length(hwy_df$created)]`

```{r "clean"}

dim(hwy_df)
##Get tweets with Santiam Pass
hwy20_Santiam <-hwy_df[grep("Santiam Pass Summit", hwy_df$text),]

hwy20_SantiamCrash <-hwy20_Santiam[grep("crash", hwy20_Santiam$text),]

##dedup the data

hwy20_SantiamCrash<-hwy20_SantiamCrash[!duplicated(hwy20_SantiamCrash$created),]



## get some details on the crash from teh text string
        ##this usually will have a mile number
        
        midist<-lapply(hwy20_SantiamCrash$text, function(x) {y<- regexpr("Mi", x)
                                                             if (y >4) substring(x,y-3,y-1)
                                                             else "NA"})
                                                            # if (y != FALSE) substring(x, y-3, y-1)})
        

        dir<-lapply(hwy20_SantiamCrash$text, function(x) {y<- regexpr("Mi", x)
                                                             if (y >4) substring(x,y+2,y+3)
                                                             else "NA"})
#hwy20_SantiamCrash$text<-substring(hwy20_SantiamCrash$text,7,12)
        

        dim(hwy20_SantiamCrash)



```

```{r "plot_the_data"}


##timeline(hwy20_SantiamCrash)

rangeYM<- c(hwy20_SantiamCrash$created[length(hwy20_SantiamCrash$created)], hwy20_SantiamCrash$created[1])
```

```{r}
rangeYM

plot(NA,ylim=c(-1,1),xlim=rangeYM,ann=FALSE,axes=FALSE)
abline(h=0,lwd=2,col="#5B7FA3")

ypts <- rep_len(c(-1,1), length.out=nrow(hwy20_SantiamCrash))
y0pts = rep_len(0, length.out=nrow(hwy20_SantiamCrash))
txtpts <- rep_len(c(1,3), length.out=nrow(hwy20_SantiamCrash))
ylblpts <- rep_len(c(-.9,.9, -.7, .7, -.5, .5), length.out=nrow(hwy20_SantiamCrash))
lblpts <- rep_len(c(3,1), length.out=nrow(hwy20_SantiamCrash))
segments(as.Date(hwy20_SantiamCrash$created),y0pts,as.Date(hwy20_SantiamCrash$created),1,col="gray80")

axis.Date(
 1,
 at=seq.Date(rangeYM[1],rangeYM[2],by="month"),
 format="%Y-%m",
 cex.axis=0.6,
 pos=0,
 lwd=0,
 lwd.tick=2,
 col="#5B7FA3",
 font=2
)

points(hwy20_SantiamCrash$created,y=ypts, pch="-", cex=1.5, col="#5B7FA3")
par(xpd=NA)
text(
  hwy20_SantiamCrash$created, y=ylblpts,
  labels=hwy20_SantiamCrash$text, cex=0.5, pos=lblpts, srt=90
)
par(xpd=FALSE)


```