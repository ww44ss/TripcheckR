---
title: "Highway 20 Santiam Pass"
author: "Winston Saunders"
date: "October 26, 2014"
output: html_document
---

```{r, results:asis}

require(twitteR)
require(ROAuth)
## A real example, but using a fictitious consumerkey and consumer
## secret - youâ€™ll need to supply your own

        reqURL <- "https://api.twitter.com/oauth/request_token"
        accessURL <- "https://api.twitter.com/oauth/access_token"
        authURL <- "https://api.twitter.com/oauth/authorize"
        consumerKey <- "7UddBUI2lFO6dIJuOplYuGSr4"
        consumerSecret <- "UO50oEmKoIKP6LRBNrcs4LsPVekltKrDWQh6tMn7nQ9t5eB6SI"

twitCred <- OAuthFactory$new(consumerKey=consumerKey,
        consumerSecret=consumerSecret,
        requestURL=reqURL,
        accessURL=accessURL,
        authURL=authURL)

twitCred$handshake()
```

```{r}
registerTwitterOAuth(twitCred)

```


```{r "get_tweets"}

## Get the relevnat tweet data

        user <- getUser("@TripCheckUS20B")

        hwy20Bfull<-userTimeline(user, n=600, maxID=NULL, sinceID=NULL, includeRts=FALSE)

        ##convert data to dataframe
        hwy20_df<-do.call(rbind,lapply(hwy20Bfull,as.data.frame))

        ##convert times to R format
        hwy20_df$created<-as.Date(hwy20_df$created)

```

The data pulled is from `r hwy20_df$created[1]` to `r hwy20_df$created[length(hwy20_df$created)]`

```{r "clean"}

dim(hwy20_df)
##Get tweets with Santiam Pass
hwy20_Santiam <-hwy20_df[grep("Santiam Pass Summit", hwy20_df$text),]

hwy20_SantiamCrash <-hwy20_Santiam[grep("crash", hwy20_Santiam$text),]

##dedup the data

hwy20_SantiamCrash<-hwy20_SantiamCrash[!duplicated(hwy20_SantiamCrash$created),]

hwy20_SantiamCrash$text<-substring(hwy20_SantiamCrash$text,6,12)

dim(hwy20_SantiamCrash)



```

```{r "plot_the_data"}


##timeline(hwy20_SantiamCrash)

rangeYM<- c(hwy20_SantiamCrash$created[length(hwy20_SantiamCrash$created)], hwy20_SantiamCrash$created[1])

rangeYM

plot(NA,ylim=c(-1,1),xlim=rangeYM,ann=FALSE,axes=FALSE)
abline(h=0,lwd=2,col="#5B7FA3")

ypts <- rep_len(c(-1,1), length.out=nrow(hwy20_SantiamCrash))
txtpts <- rep_len(c(1,3), length.out=nrow(hwy20_SantiamCrash))
lblpts <- rep_len(c(1,3), length.out=nrow(hwy20_SantiamCrash))
segments(hwy20_SantiamCrash$created,0,hwy20_SantiamCrash$created,ypts,col="gray80")

axis.Date(
 1,
 at=seq.Date(rangeYM[1],rangeYM[2],by="month"),
 format="%Y-%m",
 cex.axis=0.6,
 pos=0,
 lwd=0,
 lwd.tick=2,
 col="#5B7FA3",
 font=2
)

points(hwy20_SantiamCrash$created,y=ypts, pch="-", cex=1.5, col="#5B7FA3")
par(xpd=NA)
text(
  hwy20_SantiamCrash$created, y=ypts,
  labels=hwy20_SantiamCrash$text, cex=0.7, pos=lblpts, srt=90
)
par(xpd=FALSE)


